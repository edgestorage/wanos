# WANOS Caddyfile
# Auto-generated by install.sh
# TLS_MODE: internal (self-signed) or auto (Let's Encrypt)

# Console (Web UI) - Main domain
{$DOMAIN:localhost} {
    tls {$TLS_MODE:internal}
    reverse_proxy console:3000
}

# S3 API endpoint
s3.{$DOMAIN:localhost} {
    tls {$TLS_MODE:internal}
    reverse_proxy server:9000
}

# Internal API
api.{$DOMAIN:localhost} {
    tls {$TLS_MODE:internal}
    reverse_proxy server:9001
}

# WebDAV endpoint
webdav.{$DOMAIN:localhost} {
    tls {$TLS_MODE:internal}
    reverse_proxy server:9002
}

# Catch-all: Any unmatched domain defaults to S3
# This allows custom domains to directly access S3 API
# e.g., bucket.custom-domain.com -> S3
:443 {
    tls {$TLS_MODE:internal}
    reverse_proxy server:9000
}

:80 {
    reverse_proxy server:9000
}
